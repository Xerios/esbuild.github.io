var b=class{constructor(e){let n=e.e===0?e.a.length:0,i=e.p.getTime(),s=e.g.getTime();this.dev=1,this.ino=e.S,this.mode=e.e===0?32768:16384,this.nlink=1,this.uid=1,this.gid=1,this.rdev=0,this.size=n,this.blksize=4096,this.blocks=n+(4096-1)&4096-1,this.atimeMs=i,this.mtimeMs=i,this.ctimeMs=s,this.birthtimeMs=s,this.atime=e.p,this.mtime=e.p,this.ctime=e.g,this.birthtime=e.g}isDirectory(){return this.mode===16384}isFile(){return this.mode===32768}},D=y("EBADF"),I=y("EINVAL"),T=y("EISDIR"),z=y("ENOENT"),A=y("ENOTDIR"),E=new Map,L=new TextEncoder,C=new TextDecoder,x=B(),$=3,P=1,h="",M,S;function k(t,e,r,n,i){if(t<=2)t===2?U(e,r,n):M(t,e,r,n,i);else throw I}function W(t,e,r,n,i,s){if(t<=2)S(t,e,r,n,i,s);else{let o=E.get(t);if(!o)s(D,0,e);else if(o.w.e===1)s(T,0,e);else{let c=o.w.a;if(i!==null&&i!==-1){let m=c.slice(i,i+n);e.set(m,r),s(null,m.length,e)}else{let m=c.slice(o.T,o.T+n);o.T+=m.length,e.set(m,r),s(null,m.length,e)}}}}function F(t){throw new Error(JSON.stringify(t)+" cannot be both a file and a directory")}function v(t){x.s.clear(),h="";for(let e in t){let r=N(O(e)),n=x;for(let s=0;s+1<r.length;s++){let o=r[s],c=n.s.get(o);c?c.e!==1&&F(o):(c=B(),n.s.set(o,c)),n=c}let i=r[r.length-1];n.s.has(i)&&F(i),n.s.set(i,j(L.encode(t[e])))}}globalThis.fs={get writeSync(){return k},set writeSync(t){M=t},get read(){return W},set read(t){S=t},constants:{O_WRONLY:-1,O_RDWR:-1,O_CREAT:-1,O_TRUNC:-1,O_APPEND:-1,O_EXCL:-1},open(t,e,r,n){try{let i=p(t),s=$++;E.set(s,{w:i,T:0}),n(null,s)}catch(i){n(i,null)}},close(t,e){e(E.delete(t)?null:D)},write(t,e,r,n,i,s){t<=2?(t===2?U(e,r,n):M(t,e,r,n,i),s(null,n,e)):s(I,0,e)},readdir(t,e){try{let r=p(t);if(r.e!==1)throw A;e(null,[...r.s.keys()])}catch(r){e(r,null)}},stat(t,e){try{let r=p(t);e(null,new b(r))}catch(r){e(r,null)}},lstat(t,e){try{let r=p(t);e(null,new b(r))}catch(r){e(r,null)}},fstat(t,e){let r=E.get(t);r?e(null,new b(r.w)):e(D,null)}};function j(t){let e=new Date;return{e:0,S:P++,g:e,p:e,a:t}}function B(){let t=new Date;return{e:1,S:P++,g:t,p:t,s:new Map}}function O(t){t[0]!=="/"&&(t="/"+t);let e=t.split("/");e.shift();let r=0;for(let n=0;n<e.length;n++){let i=e[n];i===".."?r&&r--:i!=="."&&i!==""&&(e[r++]=i)}return e.length=r,"/"+e.join("/")}function N(t){if(t=O(t),t==="/")return[];let e=t.split("/");return e.shift(),e}function p(t){let e=N(t),r=x;for(let n=0,i=e.length;n<i;n++){let s=r.s.get(e[n]);if(!s)throw z;if(s.e===0){if(n+1===i)return s;throw A}r=s}return r}function y(t){let e=new Error(t);return e.code=t,e}function U(t,e,r){h+=C.decode(e===0&&r===t.length?t:t.slice(e,e+r))}var K=async([t,e])=>{let[r,n,i]=t.split(".").map(c=>+c),s=r===0&&(n===5&&i>=20||n>=6&&n<=7||n===8&&i<=34),o={wasmURL:URL.createObjectURL(new Blob([e],{type:"application/wasm"}))};return s||(o.worker=!1),esbuild.startService?await esbuild.startService(o):(await esbuild.initialize(o),esbuild)},R=(t,e,r)=>{if(t.formatMessages)return t.formatMessages(e,r);let n=(i,s,o)=>{let c=i==="note"?"   ":"\x1B[1m > ";if(o&&(c+=`${o.file}:${o.line}:${o.column}: `),c+=i==="error"?"\x1B[31merror:\x1B[1m ":i==="warning"?"\x1B[35mwarning:\x1B[1m ":"\x1B[1mnote:\x1B[0m ",c+=s+`\x1B[0m
`,o){let{line:m,column:a,length:l,lineText:u}=o,d=m.toString().padStart(5);c+=`\x1B[37m${d} \u2502 ${u.slice(0,a)}\x1B[32m${u.slice(a,a+l)}\x1B[37m${u.slice(a+l)}
${" ".repeat(d.length)} \u2575 \x1B[32m${" ".repeat(a)}${l>1?"~".repeat(l):"^"}\x1B[0m
`}return c};return Promise.resolve(e.map(i=>{let s=n(r.kind,i.text,i.location);for(let o of i.notes||[])s+=n("note",o.text,o.location);return s+`
`}))};onmessage=t=>{K(t.data).then(e=>{onmessage=r=>{let n=(a,l)=>{let u=l&&l.errors,d=l&&l.warnings;!u&&!d&&(u=[{text:l+""}]),Promise.all([u?R(e,u,{kind:"error",color:m}):[],d?R(e,d,{kind:"warning",color:m}):[]]).then(([g,f])=>{a({i:[...g,...f].join("")})})},i=(a,l)=>{for(let u of a){let d=l.replace(u,"");if(d!==l)l=d;else{let g=u.replace(/\x1B\[[^m]*m/g,"");g!==u&&(l=l.replace(g,""))}}return a.join("")+l},s=(a,l)=>{a.length?R(e,a,{kind:"warning",color:m}).then(u=>l(i(u,h))):l(h)},o=r.data,c=postMessage,m=!0;try{o.y==="transform"?(o.l.color===!1&&(m=!1),v({}),e.transform(o.b,o.l).then(({code:a,map:l,js:u,jsSourceMap:d,warnings:g,mangleCache:f,legalComments:w})=>s(g,_=>c({I:a!=null?a:u,P:l!=null?l:d,h:f,C:w,i:_})),a=>n(c,a))):o.y==="build"&&(o.l.color===!1&&(m=!1),v(o.b),e.build(o.l).then(({warnings:a,outputFiles:l,metafile:u,mangleCache:d})=>s(a,g=>c({O:l.map(({path:f,text:w})=>({path:f,text:w})),$:u,h:d,i:g})),a=>n(c,a)))}catch(a){n(c,a)}},postMessage({k:"success"})}).catch(e=>{console.error(e),postMessage({k:"failure",A:e+""})})};
